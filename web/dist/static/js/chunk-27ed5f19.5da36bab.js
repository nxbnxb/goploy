(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27ed5f19"],{"0dde":function(t,e,a){"use strict";var o=a("c9fb"),n=a.n(o);n.a},"84a2":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{staticClass:"app-container"},[a("el-row",{staticClass:"app-bar",attrs:{type:"flex",justify:"end"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.handleAdd}},[t._v("添加")])],1),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{border:"",stripe:"","highlight-current-row":"",data:t.tableData}},[a("el-table-column",{attrs:{prop:"name",label:"应用名称","min-width":"140"}}),t._v(" "),a("el-table-column",{attrs:{prop:"domain",label:"Domain","min-width":"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(e.row.domain)+":"+t._s(e.row.port)+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"second",label:"间隔(s)",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"times",label:"连续失败次数",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"notifyType",label:"通知方式",width:"70"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.notifyType?a("span",[t._v("企业微信")]):2===e.row.notifyType?a("span",[t._v("钉钉")]):3===e.row.notifyType?a("span",[t._v("飞书")]):255===e.row.notifyType?a("span",[t._v("自定义")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"description",label:"描述","min-width":"140","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"state",label:"状态",width:"45"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(1===e.row.state?"开启":"暂停")+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"insertTime",label:"创建时间",width:"160"}}),t._v(" "),a("el-table-column",{attrs:{prop:"updateTime",label:"更新时间",width:"160"}}),t._v(" "),a("el-table-column",{attrs:{prop:"operation",label:"操作",width:"220",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary"},on:{click:function(a){return t.handleEdit(e.row)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{type:1===e.row.state?"warning":"success"},on:{click:function(a){return t.handleToggle(e.row)}}},[t._v("\n          "+t._s(1===e.row.state?"暂停":"开启")+"\n        ")]),t._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:function(a){return t.handleRemove(e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),a("el-row",{staticStyle:{"margin-top":"10px"},attrs:{type:"flex",justify:"end"}},[a("el-pagination",{attrs:{"hide-on-single-page":"",total:t.pagination.total,"page-size":t.pagination.rows,background:"",layout:"prev, pager, next"},on:{"current-change":t.handlePageChange}})],1),t._v(" "),a("el-dialog",{attrs:{title:"应用设置",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.formProps.loading,expression:"formProps.loading"}],ref:"form",attrs:{"element-loading-text":t.formProps.loadingMessage,rules:t.formRules,model:t.formData,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"应用名称",prop:"name"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"Domain/IP",prop:"domain"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"(不需要带http)"},model:{value:t.formData.domain,callback:function(e){t.$set(t.formData,"domain",e)},expression:"formData.domain"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"port",prop:"port"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.formData.port,callback:function(e){t.$set(t.formData,"port",t._n(e))},expression:"formData.port"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"间隔(s)",prop:"second"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.formData.second,callback:function(e){t.$set(t.formData,"second",t._n(e))},expression:"formData.second"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"连续失败次数",prop:"times"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.formData.times,callback:function(e){t.$set(t.formData,"times",e)},expression:"formData.times"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"通知",prop:"notifyTarget"}},[a("el-row",{attrs:{type:"flex"}},[a("el-select",{model:{value:t.formData.notifyType,callback:function(e){t.$set(t.formData,"notifyType",e)},expression:"formData.notifyType"}},[a("el-option",{attrs:{label:"企业微信",value:1}}),t._v(" "),a("el-option",{attrs:{label:"钉钉",value:2}}),t._v(" "),a("el-option",{attrs:{label:"飞书",value:3}}),t._v(" "),a("el-option",{attrs:{label:"自定义",value:255}})],1),t._v(" "),a("el-input",{attrs:{autocomplete:"off",placeholder:"webhook链接"},model:{value:t.formData.notifyTarget,callback:function(e){t.$set(t.formData,"notifyTarget","string"===typeof e?e.trim():e)},expression:"formData.notifyTarget"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"描述",prop:"description"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:2},placeholder:"请输入描述"},model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-row",{attrs:{type:"flex",justify:"space-between"}},[a("el-button",{attrs:{type:"success"},on:{click:t.check}},[t._v("测试应用状态")]),t._v(" "),a("el-row",[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{disabled:t.formProps.disabled,type:"primary"},on:{click:t.submit}},[t._v("确 定")])],1)],1)],1)],1)],1)},n=[],i=a("b775");function r(t){var e=t.page,a=t.rows;return Object(i["a"])({url:"/monitor/getList",method:"get",params:{page:e,rows:a}})}function s(){return Object(i["a"])({url:"/monitor/getTotal",method:"get",params:{}})}function l(t){return Object(i["a"])({url:"/monitor/add",method:"post",data:t})}function c(t){return Object(i["a"])({url:"/monitor/edit",method:"post",data:t})}function m(t){return Object(i["a"])({timeout:1e5,url:"/monitor/check",method:"post",data:t})}function f(t){return Object(i["a"])({url:"/monitor/toggle",method:"post",data:{id:t}})}function u(t){return Object(i["a"])({url:"/monitor/remove",method:"delete",data:{id:t}})}var p={data:function(){return{dialogVisible:!1,tableData:[],pagination:{page:1,rows:16,total:0},tempFormData:{},formProps:{loading:!1,loadingMessage:"测试连接中，请稍后",disabled:!1},formData:{id:0,name:"",domain:"",port:80,second:3,times:1,notifyType:1,notifyTarget:""},formRules:{name:[{required:!0,message:"请输入应用名称",trigger:"blur"}],domain:[{required:!0,message:"请输入host或者ip(不需要带http)",trigger:"blur"}],port:[{type:"number",required:!0,min:0,max:65535,message:"请输入正确服务器端口",trigger:"blur"}],second:[{type:"number",required:!0,min:1,message:"请输入时间间隔",trigger:"blur"}],times:[{type:"number",required:!0,min:1,message:"请输入连续失败次数",trigger:"blur"}],notifyTarget:[{required:!0,message:"请填写webhook链接"}],description:[{max:255,message:"描述最多255个字符",trigger:"blur"}]}}},created:function(){this.storeFormData(),this.getList(),this.getTotal()},methods:{getList:function(){var t=this;r(this.pagination).then((function(e){t.tableData=e.data.list}))},getTotal:function(){var t=this;s().then((function(e){t.pagination.total=e.data.total}))},handlePageChange:function(t){this.pagination.page=t,this.getList()},handleAdd:function(){this.restoreFormData(),this.dialogVisible=!0},handleEdit:function(t){this.formData=Object.assign({},t),this.dialogVisible=!0},handleToggle:function(t){var e=this;1===t.state?this.$confirm("此操作将暂停监控该应用, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){f(t.id).then((function(t){e.$message.success("暂停成功"),e.getList()}))})).catch((function(){e.$message.info("已取消暂停")})):f(t.id).then((function(t){e.$message.success("开启成功"),e.getList()}))},handleRemove:function(t){var e=this;this.$confirm("此操作将不再监控该应用, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){u(t.id).then((function(t){e.$message.success("删除成功"),e.getList(),e.getTotal()}))})).catch((function(){e.$message.info("已取消删除")}))},check:function(){var t=this;this.$refs.form.validate((function(e){if(!e)return!1;t.formProps.loading=!0,t.formProps.disabled=!0,m(t.formData).then((function(e){t.$message.success("连接成功")})).finally((function(e){t.formProps.loading=!1,t.formProps.disabled=!1}))}))},submit:function(){var t=this;this.$refs.form.validate((function(e){if(!e)return!1;0===t.formData.id?t.add():t.edit()}))},add:function(){var t=this;this.formProps.disabled=!0,l(this.formData).then((function(e){t.getList(),t.getTotal(),t.$message.success("添加成功")})).finally((function(){t.formProps.disabled=t.dialogVisible=!1}))},edit:function(){var t=this;this.formProps.disabled=!0,c(this.formData).then((function(e){t.getList(),t.$message.success("编辑成功")})).finally((function(){t.formProps.disabled=t.dialogVisible=!1}))},storeFormData:function(){this.tempFormData=JSON.parse(JSON.stringify(this.formData))},restoreFormData:function(){this.formData=JSON.parse(JSON.stringify(this.tempFormData))}}},d=p,g=(a("0dde"),a("4023")),b=Object(g["a"])(d,o,n,!1,null,"7146b8ca",null);e["default"]=b.exports},c9fb:function(t,e,a){}}]);